<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Metro Terminal ‚Äî K√≥dy</title>
<style>
  :root {
    --accent: #8b0000;
    --green: #00ff66;
  }
  body,html,#app {
    margin: 0; padding: 0; height: 100%;
    font-family: monospace;
    background: #050505;
    color: #d8d8d8;
  }
  #app {
    max-width: 900px;
    margin: 0 auto;
    position: relative;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .topbar {
    height: 56px;
    background: #111;
    color: white;
    display: flex;
    align-items: center;
    padding: 0 12px;
    justify-content: space-between;
    border-bottom: 2px solid var(--accent);
    position: relative;
    z-index: 1001;
  }
  #tools-container {
    display: flex;
    gap: 8px;
  }
  .tool-button {
    background: #222;
    border: 1.5px solid var(--accent);
    color: var(--green);
    cursor: pointer;
    padding: 6px 10px;
    font-size: 20px;
    border-radius: 4px;
    user-select: none;
  }
  .tool-button.active {
    background: var(--accent);
    color: white;
  }

  /* Efekt sv√≠tilny */
  #flashlight-overlay {
    position: absolute;
    top: 56px;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    background: radial-gradient(circle at center, rgba(255,255,255,1) 0%, rgba(255,255,255,0.85) 25%, rgba(0,0,0,0.95) 60%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 900;
  }
  #flashlight-overlay.active {
    opacity: 1;
  }

  /* Efekt plynov√© masky */
  #gas-mask-overlay {
    position: absolute;
    top: 56px;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    background-color: rgba(200, 200, 180, 0.15);
    opacity: 0;
    transition: opacity 0.5s ease;
    z-index: 800;
  }
  #gas-mask-overlay.active {
    opacity: 1;
  }
  #gas-mask-fog {
    position: absolute;
    top: 56px;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    backdrop-filter: none;
    background: rgba(255,255,255,0);
    transition: backdrop-filter 0.5s ease, background 0.5s ease;
    z-index: 850;
  }
  #gas-mask-fog.foggy {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(4px);
  }

  /* Tlaƒç√≠tka vymƒõnit */
  #flashlight-replace-btn,
  #gas-mask-replace-btn {
    position: absolute;
    top: 56px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--accent);
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 700;
    display: none;
    user-select: none;
    z-index: 1002;
  }
  #flashlight-replace-btn:hover,
  #gas-mask-replace-btn:hover {
    background: #ff0000;
  }

  /* Zobrazov√°n√≠ surovin */
  .resources {
    display: flex;
    gap: 20px;
    justify-content: center;
    padding: 8px;
    background: #0b0b0b;
    border-top: 2px solid var(--accent);
    color: var(--green);
  }
</style>
</head>
<body>
<main id="app">
  <header class="topbar">
    <span>TERMIN√ÅL ‚Ä¢ STANICE</span>
    <div id="tools-container"></div>
    <span style="color:red;">OFFLINE</span>
  </header>

  <div style="flex:1; display:flex; align-items:center; justify-content:center; font-size:36px;">METRO 2033</div>

  <div id="flashlight-overlay"></div>
  <div id="gas-mask-overlay"></div>
  <div id="gas-mask-fog"></div>

  <button id="flashlight-replace-btn">Sv√≠tilna: vymƒõnit baterie</button>
  <button id="gas-mask-replace-btn">Plynov√° maska: vymƒõnit filtr</button>

  <div class="resources">
    <div>Baterie: <span id="res-b">1</span></div>
    <div>Filtry: <span id="res-f">1</span></div>
  </div>
</main>

<script>
  const tools = [
    { id: 'map', label: 'üó∫Ô∏è', title: 'Mapa' },
    { id: 'flashlight', label: 'üî¶', title: 'Sv√≠tilna' },
    { id: 'gas-mask', label: 'üò∑', title: 'Plynov√° maska' },
  ];

  let resources = { battery: 1, filter: 1 };
  let activeTools = [];

  // ƒåasovaƒçe a intervaly
  let flashlightTime = 60;
  let flashlightInterval = null;

  let gasMaskTime = 180;
  let gasMaskInterval = null;

  const flashlightOverlay = document.getElementById('flashlight-overlay');
  const gasMaskOverlay = document.getElementById('gas-mask-overlay');
  const gasMaskFog = document.getElementById('gas-mask-fog');

  const flashlightBtn = document.getElementById('flashlight-replace-btn');
  const gasMaskBtn = document.getElementById('gas-mask-replace-btn');

  function initTools() {
    const container = document.getElementById('tools-container');
    tools.forEach(tool => {
      const btn = document.createElement('button');
      btn.className = 'tool-button';
      btn.id = `tool-${tool.id}`;
      btn.title = tool.title;
      btn.textContent = tool.label;

      btn.addEventListener('click', () => toggleTool(tool.id, btn));
      container.appendChild(btn);
    });
  }

  function toggleTool(toolId, btn) {
    // Nelze mapa + sv√≠tilna dohromady
    if ((toolId === 'map' && activeTools.includes('flashlight')) ||
        (toolId === 'flashlight' && activeTools.includes('map'))) {
      return;
    }

    if (activeTools.includes(toolId)) {
      activeTools = activeTools.filter(t => t !== toolId);
      btn.classList.remove('active');
      deactivateToolEffect(toolId);
    } else {
      activeTools.push(toolId);
      btn.classList.add('active');
      activateToolEffect(toolId);
    }
  }

  function activateToolEffect(toolId) {
    if (toolId === 'flashlight') {
      flashlightTime = 60;
      flashlightOverlay.style.opacity = '1';
      flashlightOverlay.classList.add('active');
      hideFlashlightReplaceBtn();
      if (flashlightInterval) clearInterval(flashlightInterval);
      flashlightInterval = setInterval(() => {
        flashlightTime--;
        if (flashlightTime <= 10 && resources.battery > 0) {
          flashlightOverlay.style.opacity = (flashlightTime / 10).toFixed(2);
          showFlashlightReplaceBtn();
        } else {
          flashlightOverlay.style.opacity = '1';
          hideFlashlightReplaceBtn();
        }
        if (flashlightTime <= 0) {
          deactivateTool('flashlight');
        }
      }, 1000);
    } else if (toolId === 'gas-mask') {
      gasMaskTime = 180;
      gasMaskOverlay.classList.add('active');
      gasMaskFog.classList.remove('foggy');
      hideGasMaskReplaceBtn();
      if (gasMaskInterval) clearInterval(gasMaskInterval);
      gasMaskInterval = setInterval(() => {
        gasMaskTime--;
        if (gasMaskTime <= 20) {
          gasMaskFog.classList.add('foggy');
          if (resources.filter > 0) {
            showGasMaskReplaceBtn();
          } else {
            hideGasMaskReplaceBtn();
          }
        } else {
          gasMaskFog.classList.remove('foggy');
          hideGasMaskReplaceBtn();
        }
        if (gasMaskTime <= 0) {
          deactivateTool('gas-mask');
        }
      }, 1000);
    }
  }

  function deactivateToolEffect(toolId) {
    if (toolId === 'flashlight') {
      flashlightOverlay.classList.remove('active');
      flashlightOverlay.style.opacity = '0';
      hideFlashlightReplaceBtn();
      if (flashlightInterval) {
        clearInterval(flashlightInterval);
        flashlightInterval = null;
      }
      flashlightTime = 60;
    } else if (toolId === 'gas-mask') {
      gasMaskOverlay.classList.remove('active');
      gasMaskFog.classList.remove('foggy');
      hideGasMaskReplaceBtn();
      if (gasMaskInterval) {
        clearInterval(gasMaskInterval);
        gasMaskInterval = null;
      }
      gasMaskTime = 180;
    }
  }

  // Tlaƒç√≠tka v√Ωmƒõny baterie a filtru
  flashlightBtn.addEventListener('click', () => {
    if (resources.battery > 0) {
      resources.battery--;
      updateResourcesDisplay();
      flashlightTime += 30;
      if (flashlightTime > 60) flashlightTime = 60;
      hideFlashlightReplaceBtn();
    }
  });

  gasMaskBtn.addEventListener('click', () => {
    if (resources.filter > 0) {
      resources.filter--;
      updateResourcesDisplay();
      gasMaskTime += 60;
      if (gasMaskTime > 180) gasMaskTime = 180;
      hideGasMaskReplaceBtn();
      gasMaskFog.classList.remove('foggy');
    }
  });

  function showFlashlightReplaceBtn() {
    if (resources.battery > 0) flashlightBtn.style.display = 'block';
  }
  function hideFlashlightReplaceBtn() {
    flashlightBtn.style.display = 'none';
  }

  function showGasMaskReplaceBtn() {
    if (resources.filter > 0) gasMaskBtn.style.display = 'block';
  }
  function hideGasMaskReplaceBtn() {
    gasMaskBtn.style.display = 'none';
  }

  function updateResourcesDisplay() {
    document.getElementById('res-b').textContent = resources.battery;
    document.getElementById('res-f').textContent = resources.filter;
  }

  initTools();
  updateResourcesDisplay();

</script>
</body>
</html>
